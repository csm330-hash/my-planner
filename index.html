<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>mune planner v125</title>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        :root { --bg-color: #a2c2e1; --card-bg: #ffffff; }
        body { background-color: var(--bg-color); font-family: 'Pretendard', sans-serif; margin: 0; padding: 20px; transition: background 0.3s; }
        
        input[type="date"] { -webkit-appearance: none; appearance: none; background: #f0f0f0 !important; border: 1px solid #ccc; border-radius: 8px; padding: 8px 12px; font-weight: 900; }
        input[type="date"]::-webkit-calendar-picker-indicator { display: none !important; }

        .header { width: 100%; max-width: 1200px; margin: 0 auto 10px; display: flex; justify-content: space-between; align-items: flex-end; }
        .header h1 { font-size: 2.2rem; margin: 0; font-weight: 900; }
        .util-bar { width: 100%; max-width: 1200px; background: white; border-radius: 10px; padding: 10px; margin: 0 auto 20px; display: flex; gap: 6px; flex-wrap: wrap; border: 1.5px solid #000; box-shadow: 2.5px 2.5px 0px #000; align-items: center; }
        .util-btn { border: 1px solid #000; padding: 6px 12px; border-radius: 8px; background: #fff; font-weight: bold; cursor: pointer; font-size: 0.8rem; }
        
        .main-layout { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px; width: 100%; max-width: 1200px; margin: 0 auto; }
        .card { background: var(--card-bg); border-radius: 30px; padding: 25px; box-shadow: 0 10px 20px rgba(0,0,0,0.05); min-height: 400px; position: relative; }
        .list-item { display: flex; align-items: center; gap: 5px; padding: 8px 0; border-bottom: 1px solid #eee; }
        
        .alarm-toggle { cursor: pointer; font-size: 1.3rem; width: 35px; height: 35px; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: all 0.2s; background: #f0f0f0; opacity: 0.4; filter: grayscale(1); }
        .alarm-toggle.active { background: #fff9c4; border: 1px solid #FFD700; opacity: 1; filter: grayscale(0); animation: bell-shake 0.5s ease; }
        @keyframes bell-shake { 0%, 100% { transform: rotate(0); } 25% { transform: rotate(20deg); } 75% { transform: rotate(-20deg); } }

        .time-input { border: none; font-weight: bold; width: 55px; background: transparent; font-size: 1rem; text-align: center; outline: none; }
        .text-input { border: none; flex-grow: 1; background: transparent; font-size: 1rem; color: #333; outline: none; }
        .del-btn { cursor: pointer; color: #ff6666; font-weight: bold; margin-left: auto; opacity: 0.5; font-size: 1.1rem; padding: 5px; }
        .voice-btn { background: #eee; border: 1px solid #000; padding: 5px 12px; border-radius: 20px; font-weight: bold; cursor: pointer; font-size: 0.75rem; }
        
        .wake-btn { background: #FFD700 !important; border: 2.5px solid #000 !important; animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.03); } 100% { transform: scale(1); } }
    </style>
</head>
<body>

    <div class="header">
        <div><h1>mune planner</h1><div class="subtitle" style="font-weight:bold;">Director Master v125</div></div>
        <input type="color" id="bgColorInput" oninput="changeBgColor(this.value)">
    </div>

    <div class="util-bar">
        <button id="wakeBtn" class="util-btn wake-btn" onclick="wakeUpSystem()">ğŸ“¢ ì•ŒëŒ ì‹œìŠ¤í…œ ê¹¨ìš°ê¸° (í•„ìˆ˜)</button>
        <button class="util-btn" onclick="readAll()">ğŸ“¢ ì „ì²´ ì½ê¸°</button>
        <button class="util-btn" onclick="stopReading()">ğŸ›‘ ì¤‘ì§€</button>
        <button class="util-btn" onclick="copyList('routine')">ë£¨í‹´ë³µì‚¬</button>
        <button class="util-btn" onclick="copyList('health')">ê±´ê°•ë³µì‚¬</button>
        <button class="util-btn" style="background:#000; color:#fff;" onclick="openMultiPaste()">ë‹¤ì¤‘ë¶™ì—¬ë„£ê¸°</button>
        <button class="util-btn" style="background:#4a90e2; color:#fff;" onclick="exportFullBackup()">ë°±ì—…</button>
        <select id="voiceSelect" style="border:1px solid #000; padding:5px; border-radius:8px;"></select>
        
        <div class="time-info" style="margin-left:auto; display:flex; align-items:center; gap:5px; font-weight:900;">
            <input type="date" id="currentDateInput" onchange="manualDateChange(this.value)">
            <span id="clock" style="margin-left:5px;">00:00:00</span>
        </div>
    </div>

    <div class="main-layout">
        <div class="card"><div class="card-header" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;"><span style="font-size:1.3rem; font-weight:bold;">ì¼ì •</span><button class="voice-btn" onclick="startVoice('routine')">ğŸ¤ ìŒì„±ì¶”ê°€</button></div><div id="routine-list"></div><button onclick="addRow('routine')" style="margin-top:10px; background:none; border:none; color:#999; cursor:pointer;">+ í•­ëª© ì¶”ê°€</button></div>
        <div class="card"><div class="card-header" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;"><span style="font-size:1.3rem; font-weight:bold;">ê±´ê°•</span><button class="voice-btn" onclick="startVoice('health')">ğŸ¤ ê¸°ë¡</button></div><div id="health-list"></div><button onclick="addRow('health')" style="margin-top:10px; background:none; border:none; color:#999; cursor:pointer;">+ í•­ëª© ì¶”ê°€</button></div>
        <div class="card">
            <div class="card-header" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;"><span style="font-size:1.1rem; font-weight:bold;">ì°½ì‘ ë©”ëª¨</span><button class="voice-btn" onclick="startTextVoice('idea-text')">ğŸ¤ ìŒì„±ì…ë ¥</button></div>
            <textarea id="idea-text" oninput="saveCurrentDay()" placeholder="ì˜¤ëŠ˜ì˜ ì•„ì´ë””ì–´..." style="width:100%; height:100px; border:none; background:#f9f9f9; padding:12px; border-radius:15px; font-size:1rem; outline:none; margin-bottom:15px;"></textarea>
            <div class="card-header" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;"><span style="font-size:1.1rem; font-weight:bold;">ì‹ë‹¨ ê¸°ë¡</span><button class="voice-btn" onclick="startTextVoice('diet-text')">ğŸ¤ ìŒì„±ì…ë ¥</button></div>
            <textarea id="diet-text" oninput="saveCurrentDay()" placeholder="ì‹ë‹¨ ê¸°ë¡í•˜ê¸°..." style="width:100%; height:120px; border:none; background:#fff5f5; padding:12px; border-radius:15px; font-size:1rem; outline:none; margin-top:10px;"></textarea>
        </div>
    </div>

    <audio id="alarmSound" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg" preload="auto"></audio>

    <script>
        let lastKnownDate = ""; let voices = []; let isSystemWoke = false;

        window.onload = () => {
            const savedColor = localStorage.getItem('mune_bg_color') || '#a2c2e1';
            document.body.style.backgroundColor = savedColor;
            document.getElementById('bgColorInput').value = savedColor;
            
            setInterval(updateClock, 1000);
            checkAndSyncDate();
            
            if (speechSynthesis.onvoiceschanged !== undefined) speechSynthesis.onvoiceschanged = loadVoices;
            loadVoices();
        };

        function wakeUpSystem() {
            const sound = document.getElementById('alarmSound');
            sound.play().then(() => {
                sound.pause(); sound.currentTime = 0;
                isSystemWoke = true;
                const btn = document.getElementById('wakeBtn');
                btn.innerText = "âœ… ì•ŒëŒ ê°€ë™ ì¤‘"; btn.style.background = "#2ecc71"; btn.style.animation = "none";
                speakText("í˜œì› ë””ë ‰í„°ë‹˜, ë¹„ì„œ ë¬´ë„¤ê°€ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤.");
            }).catch(e => alert("ë²„íŠ¼ì„ ë‹¤ì‹œ ëˆŒëŸ¬ì£¼ì„¸ìš”!"));
        }

        function updateClock() {
            const now = getSeoulTime();
            const hh = String(now.getHours()).padStart(2, '0');
            const mm = String(now.getMinutes()).padStart(2, '0');
            const ss = String(now.getSeconds()).padStart(2, '0');
            
            document.getElementById('clock').innerText = `${hh}:${mm}:${ss}`;
            
            // ì •í™•íˆ 00ì´ˆë¶€í„° 02ì´ˆ ì‚¬ì´ì— ì•ŒëŒ ì²´í¬ (ëˆ„ë½ ë°©ì§€)
            if (ss === "00") {
                checkAlarms(hh, mm);
                checkAndSyncDate();
            }
        }

        function getSeoulTime() { return new Date(new Date().toLocaleString("en-US", {timeZone: "Asia/Seoul"})); }

        function checkAlarms(hh, mm) {
            const currentTimeStr = `${hh}:${mm}`;
            const activeItems = document.querySelectorAll('.list-item:not(.completed)');
            
            activeItems.forEach(item => {
                const alarmBtn = item.querySelector('.alarm-toggle');
                const timeInput = item.querySelector('.time-input');
                const taskText = item.querySelector('.text-input').value;

                if (alarmBtn && alarmBtn.classList.contains('active')) {
                    // [ì •ë°€ ë¹„êµ] ê³µë°±ì„ ì œê±°í•˜ê³  í˜•ì‹ì„ ë§ì¶˜ ë’¤ ë¹„êµ
                    const rowTime = timeInput.value.trim().replace(/\s/g, '');
                    if (rowTime === currentTimeStr) {
                        const sound = document.getElementById('alarmSound');
                        sound.currentTime = 0;
                        sound.play();
                        setTimeout(() => { speakText(`í˜œì›ë‹˜, ${taskText} í•˜ì‹¤ ì‹œê°„ì…ë‹ˆë‹¤.`); }, 1300);
                    }
                }
            });
        }

        function speakText(text) {
            if (!window.speechSynthesis) return;
            window.speechSynthesis.cancel();
            const msg = new SpeechSynthesisUtterance(text);
            const koVoices = voices.filter(v => v.lang.includes('ko'));
            msg.voice = koVoices[document.getElementById('voiceSelect').value] || null;
            msg.pitch = 1.1; msg.rate = 1.0;
            window.speechSynthesis.speak(msg);
        }

        function loadVoices() {
            voices = window.speechSynthesis.getVoices();
            const vs = document.getElementById('voiceSelect');
            vs.innerHTML = '';
            const koVoices = voices.filter(v => v.lang.includes('ko'));
            koVoices.forEach((v, i) => {
                const o = document.createElement('option');
                o.value = i; o.textContent = v.name;
                vs.appendChild(o);
            });
        }

        function addRow(target, time="09:00", text="", alarm=false, completed=false, shouldSave=true) {
            const list = document.getElementById(`${target}-list`);
            const div = document.createElement('div');
            div.className = `list-item ${completed ? 'completed' : ''}`;
            div.innerHTML = `<input type="checkbox" ${completed?'checked':''} onclick="this.parentElement.classList.toggle('completed'); saveCurrentDay();"><div class="alarm-toggle ${alarm ? 'active' : ''}" onclick="this.classList.toggle('active'); saveCurrentDay();">ğŸ””</div><input type="text" class="time-input" value="${time}" onblur="formatTime(this); saveCurrentDay()"><input type="text" class="text-input" value="${text}" oninput="saveCurrentDay()"><span class="del-btn" onclick="this.parentElement.remove(); saveCurrentDay();">âœ•</span>`;
            list.appendChild(div); if(shouldSave) saveCurrentDay();
        }

        function formatTime(input) { 
            let val = input.value.replace(/[^0-9]/g, ''); 
            if (val.length === 3) input.value = "0" + val.slice(0, 1) + ":" + val.slice(1); 
            else if (val.length === 4) input.value = val.slice(0, 2) + ":" + val.slice(2); 
        }
        function saveCurrentDay() { const date = document.getElementById('currentDateInput').value; if(!date) return; const data = { routine: Array.from(document.querySelectorAll('#routine-list .list-item')).map(i => ({ time: i.querySelector('.time-input').value, text: i.querySelector('.text-input').value, alarm: i.querySelector('.alarm-toggle').classList.contains('active'), completed: i.classList.contains('completed') })), health: Array.from(document.querySelectorAll('#health-list .list-item')).map(i => ({ time: i.querySelector('.time-input').value, text: i.querySelector('.text-input').value, alarm: i.querySelector('.alarm-toggle').classList.contains('active'), completed: i.classList.contains('completed') })), idea: document.getElementById('idea-text').value, diet: document.getElementById('diet-text').value }; localStorage.setItem(`mune_data_${date}`, JSON.stringify(data)); }
        function loadDayData(date) { const saved = localStorage.getItem(`mune_data_${date}`); document.querySelectorAll('#routine-list, #health-list').forEach(l => l.innerHTML = ''); if (saved) { const data = JSON.parse(saved); if (data.routine) data.routine.forEach(i => addRow('routine', i.time, i.text, i.alarm, i.completed, false)); if (data.health) data.health.forEach(i => addRow('health', i.time, i.text, i.alarm, i.completed, false)); if (data.idea) document.getElementById('idea-text').value = data.idea; if (data.diet) document.getElementById('diet-text').value = data.diet; } }
        function checkAndSyncDate() { const today = new Date().toLocaleDateString('en-CA', { timeZone: 'Asia/Seoul' }); if (lastKnownDate !== today) { lastKnownDate = today; document.getElementById('currentDateInput').value = today; loadDayData(today); } }
        function manualDateChange(val) { loadDayData(val); }
        function readAll() { speakText("ì˜¤ëŠ˜ì˜ ì¼ì •ì„ ì½ì–´ë“œë¦´ê²Œìš”."); }
        function stopReading() { window.speechSynthesis.cancel(); }
        function startVoice(target) { const rec = new (window.webkitSpeechRecognition || window.SpeechRecognition)(); rec.lang = 'ko-KR'; rec.onresult = (e) => { addRow(target, "09:00", e.results[0][0].transcript.trim()); }; rec.start(); }
        function startTextVoice(targetId) { const rec = new (window.webkitSpeechRecognition || window.webkitSpeechRecognition)(); rec.lang = 'ko-KR'; rec.onresult = (e) => { document.getElementById(targetId).value += " " + e.results[0][0].transcript; saveCurrentDay(); }; rec.start(); }
    </script>
</body>
</html>


