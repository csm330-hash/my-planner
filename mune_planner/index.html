<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Content Director Dashboard</title>
    <style>
        :root {
            --bg-color: #F2E9E4;
            --primary: #4A7C92;
            --secondary: #D98C52;
            --accent: #E9C46A;
            --text-dark: #222222;
            --white: #ffffff;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-dark);
            font-family: 'Pretendard', sans-serif;
            margin: 0; padding: 20px;
            display: flex; flex-direction: column; align-items: center;
        }

        .header {
            width: 100%; max-width: 800px;
            display: flex; justify-content: space-between; align-items: flex-end;
            margin-bottom: 30px; border-bottom: 3px solid var(--primary); padding-bottom: 10px;
        }

        .header h1 { margin: 0; color: var(--primary); font-size: 1.5rem; letter-spacing: -1px; }
        .title-tag { font-size: 0.8rem; background: var(--primary); color: white; padding: 2px 8px; border-radius: 4px; }

        .container {
            width: 100%; max-width: 800px;
            display: grid; grid-template-columns: 1fr 1.5fr; gap: 20px;
        }

        @media (max-width: 600px) { .container { grid-template-columns: 1fr; } }

        .card {
            background: var(--white); border-radius: 12px; padding: 20px;
            box-shadow: 6px 6px 0px rgba(74, 124, 146, 0.2); border: 1.5px solid var(--primary);
            margin-bottom: 20px;
        }

        .card-title {
            font-weight: 800; color: var(--secondary); margin-bottom: 15px;
            display: flex; align-items: center; gap: 8px; border-bottom: 1px solid #eee; padding-bottom: 8px;
        }

        /* --- D-Day ë¦¬ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ --- */
        .dday-item {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 12px; padding: 10px; background: #fdfdfd;
            border-left: 4px solid var(--accent); border-radius: 4px;
            animation: fadeIn 0.5s ease;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        .dday-label { font-size: 0.85rem; font-weight: 600; color: #555; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; max-width: 70%; }
        .dday-value { color: var(--secondary); font-weight: 800; font-size: 1rem; }

        /* --- ì—…ë¬´ ë¦¬ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ --- */
        .task-list { list-style: none; padding: 0; }
        .task-item {
            display: flex; align-items: center; gap: 10px; margin-bottom: 10px;
            padding: 12px; border-radius: 8px; background: #f9f9f9; border: 1px solid #eee;
        }
        .task-item input[type="checkbox"] { width: 18px; height: 18px; accent-color: var(--primary); }
        .task-done { text-decoration: line-through; opacity: 0.5; }

        .noti-btn {
            background: var(--accent); border: none; padding: 10px 20px;
            border-radius: 8px; font-weight: bold; cursor: pointer; margin-bottom: 20px;
            box-shadow: 3px 3px 0px var(--primary); transition: 0.2s;
        }
        .noti-btn:active { transform: translate(2px, 2px); box-shadow: 1px 1px 0px var(--primary); }
        
        .add-task { display: flex; gap: 8px; margin-top: 15px; }
        .add-task input { flex-grow: 1; border: 1px solid #ddd; border-radius: 6px; padding: 10px; outline: none; }
        .add-task button { background: var(--primary); color: white; border: none; padding: 10px 15px; border-radius: 6px; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

    <div class="header">
        <div>
            <span class="title-tag">AI VISUAL CONTENT DIRECTOR</span>
            <h1>STRATEGIC DASHBOARD</h1>
        </div>
        <div id="currentTime" style="font-weight: bold; color: var(--primary);"></div>
    </div>

    <div style="display: flex; gap: 10px;">
        <button class="noti-btn" onclick="requestNotiPermission()">ğŸ”” ì•Œë¦¼ ê¶Œí•œ í™œì„±í™”</button>
        <button class="noti-btn" style="background: var(--primary); color: white;" onclick="fetchCalendar()">ğŸ”„ ìº˜ë¦°ë” ìƒˆë¡œê³ ì¹¨</button>
    </div>

    <div class="container">
        <div class="column">
            <div class="card">
                <div class="card-title">ğŸ“… CALENDAR MILESTONES</div>
                <div id="ddayContainer">
                    <p style="font-size: 0.8rem; color: #888;">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                </div>
            </div>
        </div>

        <div class="column">
            <div class="card">
                <div class="card-title">ğŸ“ TODAY'S FOCUS</div>
                <ul class="task-list" id="taskList"></ul>
                <div class="add-task">
                    <input type="text" id="taskInput" placeholder="ìƒˆë¡œìš´ ì—…ë¬´ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                    <button onclick="addTask()">ì¶”ê°€</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ì‚¬ìš©ìë‹˜ì˜ êµ¬ê¸€ ìº˜ë¦°ë” ì£¼ì†Œ ì ìš© ì™„ë£Œ
        const ICAL_URL = "https://calendar.google.com/calendar/ical/csm330%40gmail.com/public/basic.ics"; 

        // --- ì•Œë¦¼ ê¸°ëŠ¥ ---
        function requestNotiPermission() {
            Notification.requestPermission().then(perm => {
                if (perm === "granted") alert("ì•Œë¦¼ì´ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤.");
            });
        }

        // --- êµ¬ê¸€ ìº˜ë¦°ë” ì—°ë™ ë¡œì§ (ê°•í™”í˜•) ---
        async function fetchCalendar() {
            const container = document.getElementById('ddayContainer');
            container.innerHTML = '<p style="font-size: 0.8rem; color: #888;">ì—…ë°ì´íŠ¸ ì¤‘...</p>';
            
            try {
                // ìºì‹œ ë°©ì§€ë¥¼ ìœ„í•´ íƒ€ì„ìŠ¤íƒ¬í”„ ì¶”ê°€
                const proxyUrl = `https://api.allorigins.win/get?url=${encodeURIComponent(ICAL_URL)}&t=${Date.now()}`;
                const response = await fetch(proxyUrl);
                const data = await response.json();
                const icsText = data.contents;
                
                if (!icsText) throw new Error("ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");

                const events = parseICS(icsText);
                renderDdays(events);
            } catch (e) {
                console.error("ìº˜ë¦°ë” ë¡œë“œ ì‹¤íŒ¨:", e);
                container.innerHTML = "<p style='font-size:0.8rem; color:var(--secondary);'>ìº˜ë¦°ë” ì—°ê²° ì‹¤íŒ¨. 'ê³µê°œ ì„¤ì •'ì„ í™•ì¸í•´ ì£¼ì„¸ìš”.</p>";
            }
        }

        // ICS íŒŒì¼ í•´ì„ê¸° (ì¤„ë°”ê¿ˆ ë° ë³µì¡í•œ í—¤ë” ì²˜ë¦¬ ê°•í™”)
        function parseICS(icsText) {
            const events = [];
            const lines = icsText.split(/\r?\n/);
            let currentEvent = null;

            for (let i = 0; i < lines.length; i++) {
                let line = lines[i];

                // ê¸´ ë¬¸ì¥ ì¤„ë°”ê¿ˆ ì²˜ë¦¬ (Folded lines)
                while (i + 1 < lines.length && (lines[i+1].startsWith(" ") || lines[i+1].startsWith("\t"))) {
                    line += lines[i+1].substring(1);
                    i++;
                }

                if (line.startsWith("BEGIN:VEVENT")) {
                    currentEvent = {};
                } else if (line.startsWith("END:VEVENT")) {
                    if (currentEvent && currentEvent.start && currentEvent.summary) {
                        events.push(currentEvent);
                    }
                    currentEvent = null;
                } else if (currentEvent) {
                    if (line.startsWith("SUMMARY")) {
                        const colonIndex = line.indexOf(":");
                        currentEvent.summary = line.substring(colonIndex + 1).replace(/\\/g, "");
                    } else if (line.startsWith("DTSTART")) {
                        const dateMatch = line.match(/\d{8}/);
                        if (dateMatch) currentEvent.start = dateMatch[0];
                    }
                }
            }
            return events;
        }

        function renderDdays(events) {
            const container = document.getElementById('ddayContainer');
            container.innerHTML = '';
            
            const now = new Date();
            now.setHours(0,0,0,0);

            const futureEvents = events
                .map(ev => {
                    const y = ev.start.substring(0,4), m = ev.start.substring(4,6), d = ev.start.substring(6,8);
                    const target = new Date(y, m-1, d);
                    const diff = Math.ceil((target - now) / (1000 * 60 * 60 * 24));
                    return { summary: ev.summary, diff: diff };
                })
                .filter(ev => ev.diff >= 0) // ì˜¤ëŠ˜ í¬í•¨ ë¯¸ë˜ ì¼ì •ë§Œ
                .sort((a, b) => a.diff - b.diff)
                .slice(0, 6); // ìƒìœ„ 6ê°œ í‘œì‹œ

            if (futureEvents.length === 0) {
                container.innerHTML = "<p style='font-size: 0.8rem;'>ì˜ˆì •ëœ ë§ˆì¼ìŠ¤í†¤ì´ ì—†ìŠµë‹ˆë‹¤.</p>";
                return;
            }

            futureEvents.forEach(ev => {
                const div = document.createElement('div');
                div.className = 'dday-item';
                let ddayText = ev.diff === 0 ? "D-Day" : "D-" + ev.diff;
                div.innerHTML = `
                    <span class="dday-label">${ev.summary}</span>
                    <span class="dday-value">${ddayText}</span>
                `;
                container.appendChild(div);
            });
        }

        // --- ì—…ë¬´ ë¦¬ìŠ¤íŠ¸ ---
        let tasks = JSON.parse(localStorage.getItem('director_tasks')) || [];

        function renderTasks() {
            const list = document.getElementById('taskList');
            list.innerHTML = '';
            tasks.forEach((t, i) => {
                const li = document.createElement('li');
                li.className = 'task-item';
                li.innerHTML = `
                    <input type="checkbox" ${t.done ? 'checked' : ''} onchange="toggleTask(${i})">
                    <span class="${t.done ? 'task-done' : ''}">${t.text}</span>
                    <button onclick="deleteTask(${i})" style="margin-left:auto; background:none; border:none; color:#ccc; cursor:pointer;">âœ•</button>
                `;
                list.appendChild(li);
            });
            localStorage.setItem('director_tasks', JSON.stringify(tasks));
        }

        function addTask() {
            const input = document.getElementById('taskInput');
            if (!input.value) return;
            tasks.push({ text: input.value, done: false });
            input.value = '';
            renderTasks();
        }

        function toggleTask(i) { tasks[i].done = !tasks[i].done; renderTasks(); }
        function deleteTask(i) { tasks.splice(i, 1); renderTasks(); }

        // ì´ˆê¸°í™” ë° ì‹¤ì‹œê°„ ì‹œê³„
        setInterval(() => {
            document.getElementById('currentTime').innerText = new Date().toLocaleTimeString();
        }, 1000);

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìº˜ë¦°ë” í˜¸ì¶œ
        fetchCalendar();
        renderTasks();
    </script>
</body>
</html>



