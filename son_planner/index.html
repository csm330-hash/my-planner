<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì•ˆê°œì˜ í˜¸í¡ í”Œë˜ë„ˆ</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <link rel="manifest" href="manifest.json">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#0b141d">
<link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/616/616490.png">
    <style>
        :root {
            --bg-color: #0b141d;
            --card-bg: #16242f;
            --point-color: #4df2f2;
            --text-white: #ffffff;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-white);
            font-family: 'Pretendard', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            margin: 0;
        }

        .header { text-align: center; margin-bottom: 25px; }
        .date-display { color: var(--point-color); font-size: 1.1em; font-weight: bold; margin-bottom: 5px; }
        h1 { color: var(--point-color); margin: 0; font-size: 1.8em; }
        .subtitle { color: var(--point-color); font-size: 0.9em; opacity: 0.8; }

        .container { width: 100%; max-width: 600px; }

        .card {
            background-color: var(--card-bg);
            border: 1px solid rgba(77, 242, 242, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .card-title {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: bold;
            margin-bottom: 15px;
            color: var(--point-color);
        }

        /* --- ìŠ¤í‹°ì»¤ ë³´ë“œ (ë‚ ì§œ í¬í•¨) --- */
        .sticker-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 12px;
            justify-items: center;
        }
        .sticker-slot {
            width: 50px;
            height: 50px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px dashed rgba(77, 242, 242, 0.4);
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        .sticker-img { width: 110%; height: 110%; position: absolute; }
        .sticker-date {
            position: relative;
            z-index: 2;
            color: #000; /* ë³„ ìœ„ì—ì„œ ì˜ ë³´ì´ë„ë¡ ê²€ì€ìƒ‰ */
            font-weight: bold;
            font-size: 0.9em;
            margin-top: 2px;
        }

        /* --- ì„ë¬´ ë¦¬ìŠ¤íŠ¸ (ì•ŒëŒ ì¶”ê°€) --- */
        .task-list { list-style: none; padding: 0; }
        .task-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 12px; border-radius: 10px; margin-bottom: 10px;
            display: flex; flex-direction: column; gap: 8px;
        }
        .task-main { display: flex; align-items: center; }
        .task-main input[type="checkbox"] { margin-right: 12px; accent-color: var(--point-color); }
        .task-text { flex-grow: 1; }
        .task-done { text-decoration: line-through; opacity: 0.5; }
        
        .task-alarm-settings {
            display: flex; align-items: center; gap: 10px;
            font-size: 0.85em; color: var(--point-color);
            padding-left: 30px;
        }
        .task-alarm-settings input[type="time"] {
            background: rgba(0,0,0,0.3); border: 1px solid #444;
            color: white; border-radius: 4px; padding: 2px 5px;
        }

        .add-task { display: flex; gap: 8px; margin-top: 15px; }
        .add-task input {
            flex-grow: 1; background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(77, 242, 242, 0.3);
            border-radius: 8px; padding: 10px; color: white;
        }
        .add-task button {
            background: var(--point-color); color: var(--bg-color);
            border: none; padding: 0 15px; border-radius: 8px; font-weight: bold; cursor: pointer;
        }

        /* --- ì¶•í•˜ íŒì—… --- */
        #congratsModal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); z-index: 100; align-items: center; justify-content: center;
        }
        .modal-content {
            background: var(--card-bg); border: 2px solid var(--point-color);
            padding: 40px; border-radius: 20px; text-align: center;
            box-shadow: 0 0 30px var(--point-color);
        }

        #momMessage {
            width: 100%; background: none; border: none; color: white;
            font-size: 1.1em; resize: none; outline: none; line-height: 1.6; font-style: italic;
        }
    </style>
</head>
<body>
    <audio id="soundPyo" src="https://t1.daumcdn.net/kakaocorp/kakaocorp/admin/service/1619602523212_1.mp3" preload="auto"></audio>
    <audio id="soundAlarm" src="https://assets.mixkit.co/active_storage/sfx/1014/1014-preview.m4a" preload="auto"></audio>

    <div class="header">
        <div class="date-display" id="todayDate"></div>
        <h1>ì•ˆê°œì˜ í˜¸í¡ í”Œë˜ë„ˆ</h1>
        <div class="subtitle">ì§‘ì¤‘í•´ì„œ ì˜¤ëŠ˜ì˜ ì„ë¬´ë¥¼ ì™„ìˆ˜í•˜ì!</div>
    </div>

    <div class="container">
        <div class="card">
            <div class="card-title">
                <span>ğŸŒŸ ìˆ˜ë ¨ ì¦í‘œ</span>
                <span id="stickerCount">0 / 20</span>
            </div>
            <div class="sticker-grid" id="stickerGrid"></div>
            <div style="text-align: center; margin-top: 15px;">
                <button onclick="resetStickers()" style="background:none; border:none; color:#666; cursor:pointer; font-size:0.8em;">ìŠ¤í‹°ì»¤ ì´ˆê¸°í™”</button>
            </div>
        </div>

        <div class="card">
            <div class="card-title">âœ”ï¸ ì˜¤ëŠ˜ì˜ ì„ë¬´</div>
            <ul class="task-list" id="taskList"></ul>
            <div class="add-task">
                <input type="text" id="taskInput" placeholder="ìƒˆë¡œìš´ ì„ë¬´ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                <button onclick="addTask()">ì¶”ê°€</button>
            </div>
        </div>

        <div class="card" style="background:rgba(77, 242, 242, 0.08);">
            <div style="font-weight:bold; color:var(--point-color); margin-bottom:10px;">ğŸ’¬ ì—„ë§ˆì˜ ì „ë ¹</div>
            <textarea id="momMessage" rows="3" oninput="saveMessage()" placeholder="ë©”ì‹œì§€ë¥¼ ì ì–´ì£¼ì„¸ìš”."></textarea>
        </div>
    </div>

    <div id="congratsModal" onclick="closeModal()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <h2 style="color:var(--point-color);">ğŸ‰ ìˆ˜ë ¨ ì™„ë£Œ! ğŸ‰</h2>
            <p>20ê°œì˜ ì¦í‘œë¥¼ ëª¨ë‘ ëª¨ì•˜êµ¬ë‚˜!<br>ì •ë§ ë©‹ì§€ë‹¤ ì•„ë“¤!</p>
            <button onclick="closeModal()" style="background:var(--point-color); border:none; padding:10px 25px; border-radius:10px; font-weight:bold; cursor:pointer;">ìµœê³ ì˜ˆìš”!</button>
        </div>
    </div>

    <script>
        const stickerImg = "https://cdn-icons-png.flaticon.com/512/616/616490.png";
        
        // ë°ì´í„° êµ¬ì¡° ë³€ê²½ (ë‹¨ìˆœ true/false ëŒ€ì‹  ë‚ ì§œ ìˆ«ìë¥¼ ì €ì¥)
        let stickers = JSON.parse(localStorage.getItem('son_stickers_v2')) || new Array(20).fill(0);
        let tasks = JSON.parse(localStorage.getItem('son_tasks_v2')) || [];
        let message = localStorage.getItem('son_momMessage') || "ì˜¤ëŠ˜ë„ ë¬´ì´ì¹˜ë¡œì²˜ëŸ¼ ë©‹ì§€ê²Œ!";

        function init() {
            // ìƒë‹¨ ë‚ ì§œ í‘œì‹œ
            const now = new Date();
            document.getElementById('todayDate').innerText = `${now.getFullYear()}ë…„ ${now.getMonth()+1}ì›” ${now.getDate()}ì¼`;
            
            renderTasks();
            renderStickers();
            document.getElementById('momMessage').value = message;
            
            // ì•ŒëŒ ì²´í¬ (ë§¤ë¶„ 0ì´ˆì— í™•ì¸)
            setInterval(checkAlarms, 60000);
            checkAlarms(); // ì‹œì‘í•  ë•Œ í•œë²ˆ í™•ì¸
        }

        // --- ìŠ¤í‹°ì»¤ ë¡œì§ (ë‚ ì§œ í¬í•¨) ---
        function renderStickers() {
            const grid = document.getElementById('stickerGrid');
            grid.innerHTML = '';
            let count = 0;
            stickers.forEach((dateValue, index) => {
                const slot = document.createElement('div');
                slot.className = 'sticker-slot';
                if (dateValue > 0) {
                    slot.innerHTML = `<img src="${stickerImg}" class="sticker-img"><span class="sticker-date">${dateValue}</span>`;
                    count++;
                }
                slot.onclick = () => toggleSticker(index);
                grid.appendChild(slot);
            });
            document.getElementById('stickerCount').innerText = `${count} / 20`;
            localStorage.setItem('son_stickers_v2', JSON.stringify(stickers));
            return count;
        }

        function toggleSticker(index) {
            if (stickers[index] === 0) {
                const day = new Date().getDate();
                stickers[index] = day; // ì˜¤ëŠ˜ ë‚ ì§œ ì €ì¥
                playSound('soundPyo');
                const count = renderStickers();
                if (count === 20) triggerCelebration();
            } else {
                if(confirm("ì´ ìŠ¤í‹°ì»¤ë¥¼ ì·¨ì†Œí• ê¹Œìš”?")) {
                    stickers[index] = 0;
                    renderStickers();
                }
            }
        }

        // --- ì„ë¬´ ë° ì•ŒëŒ ë¡œì§ ---
        function renderTasks() {
            const list = document.getElementById('taskList');
            list.innerHTML = '';
            tasks.forEach((task, idx) => {
                const li = document.createElement('li');
                li.className = 'task-item';
                li.innerHTML = `
                    <div class="task-main">
                        <input type="checkbox" ${task.done ? 'checked' : ''} onchange="toggleTask(${idx})">
                        <span class="task-text ${task.done ? 'task-done' : ''}">${task.text}</span>
                        <button onclick="deleteTask(${idx})" style="background:none; border:none; color:#ff6b6b; cursor:pointer;">âœ•</button>
                    </div>
                    <div class="task-alarm-settings">
                        <span>â° ì•ŒëŒ ì‹œê°„:</span>
                        <input type="time" value="${task.alarmTime || ''}" onchange="updateAlarmTime(${idx}, this.value)">
                        <label style="cursor:pointer; display:flex; align-items:center; gap:4px;">
                            <input type="checkbox" ${task.alarmOn ? 'checked' : ''} onchange="toggleAlarmSwitch(${idx})"> ì•ŒëŒì¼œê¸°
                        </label>
                    </div>
                `;
                list.appendChild(li);
            });
            localStorage.setItem('son_tasks_v2', JSON.stringify(tasks));
        }

        function addTask() {
            const input = document.getElementById('taskInput');
            if (!input.value.trim()) return;
            tasks.push({ text: input.value, done: false, alarmTime: '', alarmOn: false, alerted: false });
            input.value = '';
            renderTasks();
        }

        function toggleTask(idx) { tasks[idx].done = !tasks[idx].done; renderTasks(); }
        function deleteTask(idx) { tasks.splice(idx, 1); renderTasks(); }
        function updateAlarmTime(idx, time) { tasks[idx].alarmTime = time; tasks[idx].alerted = false; renderTasks(); }
        function toggleAlarmSwitch(idx) { tasks[idx].alarmOn = !tasks[idx].alarmOn; renderTasks(); }

        function checkAlarms() {
            const now = new Date();
            const currentStr = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
            
            tasks.forEach((task, idx) => {
                if (task.alarmOn && !task.done && task.alarmTime === currentStr && !task.alerted) {
                    task.alerted = true; // ì¤‘ë³µ ìš¸ë¦¼ ë°©ì§€
                    playSound('soundAlarm');
                    alert(`â° ì•ŒëŒ: [${task.text}] ì„ë¬´ë¥¼ ìˆ˜í–‰í•  ì‹œê°„ì´ì•¼!`);
                }
                // ì‹œê°„ì´ ì§€ë‚˜ë©´ alerted ë¦¬ì…‹ (ë‹¤ìŒë‚ ì„ ìœ„í•´)
                if (task.alarmTime !== currentStr) task.alerted = false;
            });
        }

        // --- íš¨ê³¼ ë° ê¸°íƒ€ ---
        function playSound(id) {
            const s = document.getElementById(id);
            if (s) { s.currentTime = 0; s.play().catch(() => {}); }
        }

        function triggerCelebration() {
            confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
            document.getElementById('congratsModal').style.display = 'flex';
        }

        function closeModal() { document.getElementById('congratsModal').style.display = 'none'; }
        function saveMessage() { localStorage.setItem('son_momMessage', document.getElementById('momMessage').value); }
        function resetStickers() { if(confirm("ëª¨ë“  ìŠ¤í‹°ì»¤ë¥¼ ì§€ìš¸ê¹Œìš”?")) { stickers = new Array(20).fill(0); renderStickers(); } }

        init();
        if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('sw.js');
}
    </script>
</body>
</html>
